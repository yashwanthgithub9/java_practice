<!DOCTYPE html>
<html>

<head>
  <title>ChatBot</title>
</head>

<body>
  <div class="js-container"></div>

  <script src="https://unpkg.com/supersimpledev/react.js"></script>
  <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>

  <script src="./chatbot.js"></script>
  <link rel="stylesheet"href="./style.css"></link>

  <script src="https://unpkg.com/supersimpledev/babel.js"></script>
  <script src="https://unpkg.com/supersimpledev/dayjs.js"></script>

  <script type="text/babel">
    function ChatInput({chatMessages,setChatMessages}) {
      const [inputText, setInputText]=React.useState('');
      function saveInputText(event) {
        // console.log(event.target.value)
        setInputText(event.target.value);
      }

      function sendMessage(event) {
          console.log(inputText);
          const newChatMessages=[
            ...chatMessages,
            {// this is added at the end of current message
              // if we just push its state won't change, hence it can't update UI
              message:inputText,
              sender:'user',
              id:crypto.randomUUID()
            }
          ]
          setChatMessages(newChatMessages)
        const respose=Chatbot.getResponse(inputText)
            setInputText('');
        setChatMessages(
          [
            ...newChatMessages,
            {// this is added at the end of current message
              // if we just push its state won't change, hence it can't update UI
              message:respose,
              sender:'robot',
              id:crypto.randomUUID()
            }
          ]
        )
        console.log(respose)
      }
      return (
        <div className="chat-input-container">
          <input
            placeholder="Send message to chat bot"
            size="25"
            onChange={saveInputText}
            value={inputText}
            className="text-box"
            >
          </input>
          <button
            onClick={sendMessage}
          >Send</button>
        </div>
      );
    }
    function ChatMessage({ message, sender }) { //destructuring at parameter level
      // console.log(props);
      // const msg =props.message;
      // const sender = props.sender;
      // const {msg,sender}=props; --> msg worked when creating a const but it wont
      // work with object inside props;
      // const {message,sender}=props; //destructuring

      // if (sender=="robot") {
      //   return(
      //             <div>
      //   <img src="./robot.png" width="30"></img>
      //   {message}
      //   </div> 
      //   )
      // }
      return (
        <div className={sender=='user'?'chat-msg-user':'chat-msg-robot'}>
          {sender === 'robot' && <img className="img" src="./robot.png" />}
          <div className="chat-text-msg">
            {message}
            </div>
          {sender === 'user' && <img className="img" src="./user.png" />}
        </div>
      );
    }
    function ChatMessages({chatMessages}){


      // const chatMessages=array[0];
      // const setChatMessages=array[1];
      // const [chatMessages, setChatMessages]=array;
      // function sendMessage(){
      //   // console.log('Message sent to console')
      //   // chatMessages.push({
      //   //   message:'test',
      //   //   sender:'user',
      //   //   id:crypto.randomUUID()
      //   // });
      //   setChatMessages(
      //     [
      //       ...chatMessages,
      //       {// this is added at the end of current message
      //         // if we just push its state won't change, hence it can't update UI
      //         message:'test state',
      //         sender:'user',
      //         id:crypto.randomUUID()
      //       }
      //     ]
      //   )
      //   console.log(chatMessages)
      // };
      
      return(
        <div className="chat-msgs-container">
          {chatMessages.map((chat)=>{
            return(
            <ChatMessage 
              message={chat.message}
              sender={chat.sender}
              key={chat.id}
            />
        );
      })}
      </div>
      );
    }
    function App() {
      const [chatMessages, setChatMessages] = React.useState([{
        message:'Hellooo Chatbot',
        sender:'user',
        id:'id1'
      },{
        message:'Hellooo User',
        sender:'robot',
        id:'id2'
      },{
        message:'Get me Todays date',
        sender:'user',
        id:'id3'
      },{
        message:'Hellooo Chatbot',
        sender:'robot',
        id:'id4'
      }]);
      return(
        <div className="app-container">

        <ChatMessages
          chatMessages={chatMessages}
        />
        <ChatInput 
          chatMessages={chatMessages}
          setChatMessages={setChatMessages}
        />
        </div>
      );
    }
    const container = document.querySelector('.js-container');
    ReactDOM.createRoot(container).render(<App/>);
  </script>
</body>

</html>